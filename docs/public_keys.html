
<!DOCTYPE html>

<html>
<head>
    <title>public_keys.go</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link rel="stylesheet" media="all" href="lirisi.css" />
  <link rel="stylesheet" media="all" href="gocco.css" />
</head>
<body>
<header>
    <h1><a href="index.html">Linkable Ring Signature</a></h1>
    <div>Linkable Spontaneous Anonymous Group Signature for Ad Hoc Groups.</div>
</header>
<nav>
  <a href='key_image.html'>Key image</a>
  <a href='oid.html'>Oid</a>
  <a href='public_keys.html'>Public keys</a>
  <a href='signature_factory.html'>Signature factory</a>
  <a href='signature.html'>Signature</a>
</nav>
  <div id="container">
    <div id="background"></div>
    
    <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th class="docs">
            <h1>
                public_keys.go
            </h1>
          </th>
          <th class="code">
          </th>
        </tr>
      </thead>
      <tbody>
          
          <tr id="section-1">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
                
            </td>
            <td class="code">
                <div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">client</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&quot;bytes&quot;</span>
	<span class="s">&quot;crypto/ecdsa&quot;</span>
	<span class="s">&quot;crypto/elliptic&quot;</span>
	<span class="s">&quot;encoding/asn1&quot;</span>
	<span class="s">&quot;encoding/hex&quot;</span>
	<span class="s">&quot;encoding/pem&quot;</span>
	<span class="s">&quot;hash&quot;</span>
	<span class="s">&quot;math/big&quot;</span>
	<span class="s">&quot;regexp&quot;</span>
	<span class="s">&quot;sort&quot;</span>
	<span class="s">&quot;strconv&quot;</span>

	<span class="s">&quot;github.com/zbohm/lirisi/ring&quot;</span>
	<span class="s">&quot;github.com/zbohm/lirisi/x509ec&quot;</span>
<span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-2">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
                <p>IdentKey holds filename, digest (hash) of file, instance of public key.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">type</span> <span class="nx">IdentKey</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">digest</span> <span class="kt">string</span>
	<span class="nx">key</span>    <span class="o">*</span><span class="nx">ecdsa</span><span class="p">.</span><span class="nx">PublicKey</span>
<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-3">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
                <p>HashIdentKey contains the salted hash of public key file and IdentKey.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">type</span> <span class="nx">HashIdentKey</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">hash</span> <span class="kt">string</span>
	<span class="nx">pub</span>  <span class="nx">IdentKey</span>
<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-4">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
                <p>Enter asci character LF.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Enter</span> <span class="p">=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-5">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
                <p>FoldPublicKeys create sequence of public keys coordinates.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">func</span> <span class="nx">FoldPublicKeys</span><span class="p">(</span><span class="nx">pubKeysContent</span> <span class="p">[][]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">hashName</span><span class="p">,</span> <span class="nx">format</span><span class="p">,</span> <span class="nx">order</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>

	<span class="kd">var</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">keysDigest</span> <span class="p">[]</span><span class="kt">byte</span>
	<span class="kd">var</span> <span class="nx">curve</span> <span class="nx">elliptic</span><span class="p">.</span><span class="nx">Curve</span>
	<span class="kd">var</span> <span class="nx">publicKeys</span> <span class="p">[]</span><span class="nx">HashIdentKey</span>
	<span class="kd">var</span> <span class="nx">status</span> <span class="kt">int</span>

	<span class="nx">hashFnc</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">HashCodes</span><span class="p">[</span><span class="nx">hashName</span><span class="p">]</span>
	<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">UnexpectedHashType</span><span class="p">,</span> <span class="nx">content</span>
	<span class="p">}</span>
	<span class="nx">hasherOID</span><span class="p">,</span> <span class="nx">status</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">GetHasherOID</span><span class="p">(</span><span class="nx">hashFnc</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">status</span> <span class="o">!=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">content</span>
	<span class="p">}</span>
	<span class="nx">status</span><span class="p">,</span> <span class="nx">publicKeys</span><span class="p">,</span> <span class="nx">keysDigest</span> <span class="p">=</span> <span class="nx">decodePublicKeys</span><span class="p">(</span><span class="nx">pubKeysContent</span><span class="p">,</span> <span class="nx">hashFnc</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">status</span> <span class="o">!=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">content</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">order</span> <span class="o">==</span> <span class="s">&quot;hashes&quot;</span> <span class="p">{</span>
		<span class="nx">status</span><span class="p">,</span> <span class="nx">publicKeys</span><span class="p">,</span> <span class="nx">keysDigest</span> <span class="p">=</span> <span class="nx">sortKeysByHashes</span><span class="p">(</span><span class="nx">publicKeys</span><span class="p">,</span> <span class="nx">hashFnc</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">status</span> <span class="o">!=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">content</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="nx">pointSeq</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">FoldedPublicKeys</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Origin</span> <span class="o">+</span> <span class="s">&quot; Public keys&quot;</span><span class="p">,</span> <span class="nx">HasherOID</span><span class="p">:</span> <span class="nx">hasherOID</span><span class="p">,</span> <span class="nx">Digest</span><span class="p">:</span> <span class="nx">keysDigest</span><span class="p">}</span>
	<span class="nx">compress</span> <span class="o">:=</span> <span class="kc">true</span>

	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">item</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">publicKeys</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
			<span class="nx">curve</span> <span class="p">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">Curve</span>
			<span class="nx">curveOID</span><span class="p">,</span> <span class="nx">status</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">GetCurveOIDForCurve</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">Curve</span><span class="p">)</span>
			<span class="k">if</span> <span class="nx">status</span> <span class="o">!=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">content</span>
			<span class="p">}</span>
			<span class="nx">pointSeq</span><span class="p">.</span><span class="nx">CurveOID</span> <span class="p">=</span> <span class="nx">curveOID</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-6">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
                <p>Uncompress does not work for these curves:
- secp256k1
    - brainpoolP256r1
 - brainpoolP384r1
- brainpoolP512r1</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>			<span class="nx">oid</span> <span class="o">:=</span> <span class="nx">curveOID</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
			<span class="k">if</span> <span class="nx">oid</span> <span class="o">==</span> <span class="s">&quot;1.3.132.0.10&quot;</span> <span class="o">||</span> <span class="nx">oid</span> <span class="o">==</span> <span class="s">&quot;1.3.36.3.3.2.8.1.1.7&quot;</span> <span class="o">||</span> <span class="nx">oid</span> <span class="o">==</span> <span class="s">&quot;1.3.36.3.3.2.8.1.1.11&quot;</span> <span class="o">||</span> <span class="nx">oid</span> <span class="o">==</span> <span class="s">&quot;1.3.36.3.3.2.8.1.1.13&quot;</span> <span class="p">{</span>
				<span class="nx">compress</span> <span class="p">=</span> <span class="kc">false</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">Curve</span> <span class="o">!=</span> <span class="nx">curve</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">UnexpectedCurveType</span><span class="p">,</span> <span class="nx">content</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="nx">compress</span> <span class="p">{</span>
			<span class="nx">pointSeq</span><span class="p">.</span><span class="nx">Keys</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">pointSeq</span><span class="p">.</span><span class="nx">Keys</span><span class="p">,</span> <span class="nx">elliptic</span><span class="p">.</span><span class="nx">MarshalCompressed</span><span class="p">(</span><span class="nx">curve</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">X</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">Y</span><span class="p">))</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">pointSeq</span><span class="p">.</span><span class="nx">Keys</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">pointSeq</span><span class="p">.</span><span class="nx">Keys</span><span class="p">,</span> <span class="nx">elliptic</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">curve</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">X</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">Y</span><span class="p">))</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">encodeFoldedPublicKeys</span><span class="p">(</span><span class="nx">curve</span><span class="p">,</span> <span class="nx">pointSeq</span><span class="p">,</span> <span class="nx">publicKeys</span><span class="p">,</span> <span class="nx">keysDigest</span><span class="p">,</span> <span class="nx">hashName</span><span class="p">,</span> <span class="nx">format</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">encodeFoldedPublicKeys</span><span class="p">(</span>
	<span class="nx">curve</span> <span class="nx">elliptic</span><span class="p">.</span><span class="nx">Curve</span><span class="p">,</span>
	<span class="nx">pointSeq</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">FoldedPublicKeys</span><span class="p">,</span>
	<span class="nx">publicKeys</span> <span class="p">[]</span><span class="nx">HashIdentKey</span><span class="p">,</span>
	<span class="nx">keysDigest</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span>
	<span class="nx">hashName</span><span class="p">,</span>
	<span class="nx">format</span> <span class="kt">string</span><span class="p">,</span>
<span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">content</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">pointSeq</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Asn1MarshalFailed</span><span class="p">,</span> <span class="nx">content</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">format</span> <span class="o">==</span> <span class="s">&quot;PEM&quot;</span> <span class="p">{</span>
		<span class="nx">block</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">pem</span><span class="p">.</span><span class="nx">Block</span><span class="p">{</span>
			<span class="nx">Type</span><span class="p">:</span> <span class="s">&quot;FOLDED PUBLIC KEYS&quot;</span><span class="p">,</span>
			<span class="nx">Headers</span><span class="p">:</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
				<span class="s">&quot;Origin&quot;</span><span class="p">:</span>       <span class="nx">ring</span><span class="p">.</span><span class="nx">Origin</span><span class="p">,</span>
				<span class="s">&quot;CurveName&quot;</span><span class="p">:</span>    <span class="nx">ring</span><span class="p">.</span><span class="nx">GetCurveName</span><span class="p">(</span><span class="nx">curve</span><span class="p">),</span>
				<span class="s">&quot;CurveOID&quot;</span><span class="p">:</span>     <span class="nx">pointSeq</span><span class="p">.</span><span class="nx">CurveOID</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span>
				<span class="s">&quot;HasherOID&quot;</span><span class="p">:</span>    <span class="nx">pointSeq</span><span class="p">.</span><span class="nx">HasherOID</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span>
				<span class="s">&quot;HasherName&quot;</span><span class="p">:</span>   <span class="nx">hashName</span><span class="p">,</span>
				<span class="s">&quot;NumberOfKeys&quot;</span><span class="p">:</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">publicKeys</span><span class="p">)),</span>
				<span class="s">&quot;Digest&quot;</span><span class="p">:</span>       <span class="nx">FormatDigest</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">keysDigest</span><span class="p">)),</span>
			<span class="p">},</span>
			<span class="nx">Bytes</span><span class="p">:</span> <span class="nx">content</span><span class="p">,</span>
		<span class="p">}</span>
		<span class="kd">var</span> <span class="nx">buff</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pem</span><span class="p">.</span><span class="nx">Encode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">buff</span><span class="p">,</span> <span class="nx">block</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">EncodePEMFailed</span><span class="p">,</span> <span class="nx">content</span>
		<span class="p">}</span>
		<span class="nx">content</span> <span class="p">=</span> <span class="nx">buff</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">()</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span><span class="p">,</span> <span class="nx">content</span>
<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-7">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
                <p>UnfoldPublicKeysContent restore public keys from sequence.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">func</span> <span class="nx">UnfoldPublicKeysContent</span><span class="p">(</span><span class="nx">content</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="p">[]</span><span class="o">*</span><span class="nx">ecdsa</span><span class="p">.</span><span class="nx">PublicKey</span><span class="p">,</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">FoldedPublicKeys</span><span class="p">)</span> <span class="p">{</span>

	<span class="nx">foldedKeys</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">FoldedPublicKeys</span><span class="p">{}</span>

	<span class="k">if</span> <span class="nx">matched</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">Match</span><span class="p">(</span><span class="s">`-+BEGIN FOLDED PUBLIC KEYS`</span><span class="p">,</span> <span class="nx">content</span><span class="p">);</span> <span class="nx">matched</span> <span class="p">{</span>
		<span class="nx">block</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">pem</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">block</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">DecodePEMFailure</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">foldedKeys</span>
		<span class="p">}</span>
		<span class="nx">content</span> <span class="p">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">Bytes</span>
	<span class="p">}</span>

	<span class="nx">rest</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">foldedKeys</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Asn1UnmarshalFailed</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">foldedKeys</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">rest</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-8">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
                <p>x509: trailing data after ASN.1 of public-key</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>		<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">UnexpectedRestOfSignature</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">foldedKeys</span>
	<span class="p">}</span>
	<span class="nx">curveType</span><span class="p">,</span> <span class="nx">success</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">GetCurve</span><span class="p">(</span><span class="nx">foldedKeys</span><span class="p">.</span><span class="nx">CurveOID</span><span class="p">)</span>
	<span class="k">if</span> <span class="p">!</span><span class="nx">success</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">OIDCurveNotFound</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">foldedKeys</span>
	<span class="p">}</span>
	<span class="nx">curve</span> <span class="o">:=</span> <span class="nx">curveType</span><span class="p">()</span>
	<span class="nx">publicKeys</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">ecdsa</span><span class="p">.</span><span class="nx">PublicKey</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">foldedKeys</span><span class="p">.</span><span class="nx">Keys</span><span class="p">))</span>

	<span class="kd">var</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="o">*</span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span>

	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">buff</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">foldedKeys</span><span class="p">.</span><span class="nx">Keys</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">buff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">{</span>
			<span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="p">=</span> <span class="nx">elliptic</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">curve</span><span class="p">,</span> <span class="nx">buff</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="p">=</span> <span class="nx">elliptic</span><span class="p">.</span><span class="nx">UnmarshalCompressed</span><span class="p">(</span><span class="nx">curve</span><span class="p">,</span> <span class="nx">buff</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="nx">x</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">NilPointCoordinates</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">foldedKeys</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">!</span><span class="nx">curve</span><span class="p">.</span><span class="nx">IsOnCurve</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">InvalidPointCoordinates</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">foldedKeys</span>
		<span class="p">}</span>
		<span class="nx">publicKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">ecdsa</span><span class="p">.</span><span class="nx">PublicKey</span><span class="p">{</span><span class="nx">Curve</span><span class="p">:</span> <span class="nx">curve</span><span class="p">,</span> <span class="nx">X</span><span class="p">:</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">Y</span><span class="p">:</span> <span class="nx">y</span><span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span><span class="p">,</span> <span class="nx">publicKeys</span><span class="p">,</span> <span class="nx">foldedKeys</span>
<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-9">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
                <p>UnfoldPublicKeysIntoBytes restore public keys from sequence.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">func</span> <span class="nx">UnfoldPublicKeysIntoBytes</span><span class="p">(</span><span class="nx">foldedPublicKeys</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">outFormat</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="p">[][]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">unfoldedPublicKeys</span> <span class="p">[][]</span><span class="kt">byte</span>

	<span class="nx">status</span><span class="p">,</span> <span class="nx">publicKeys</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">UnfoldPublicKeysContent</span><span class="p">(</span><span class="nx">foldedPublicKeys</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">status</span> <span class="o">!=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">unfoldedPublicKeys</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">pub</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">publicKeys</span> <span class="p">{</span>
		<span class="nx">content</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x509ec</span><span class="p">.</span><span class="nx">MarshalPKIXPublicKey</span><span class="p">(</span><span class="nx">pub</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">MarshalPKIXPublicKeyFailed</span><span class="p">,</span> <span class="nx">unfoldedPublicKeys</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="nx">outFormat</span> <span class="o">==</span> <span class="s">&quot;PEM&quot;</span> <span class="p">{</span>
			<span class="nx">block</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">pem</span><span class="p">.</span><span class="nx">Block</span><span class="p">{</span><span class="nx">Type</span><span class="p">:</span> <span class="s">&quot;PUBLIC KEY&quot;</span><span class="p">,</span> <span class="nx">Bytes</span><span class="p">:</span> <span class="nx">content</span><span class="p">}</span>
			<span class="nx">buff</span> <span class="o">:=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">NewBuffer</span><span class="p">(</span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
			<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pem</span><span class="p">.</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">buff</span><span class="p">,</span> <span class="nx">block</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">EncodePEMFailed</span><span class="p">,</span> <span class="nx">unfoldedPublicKeys</span>
			<span class="p">}</span>
			<span class="nx">unfoldedPublicKeys</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">unfoldedPublicKeys</span><span class="p">,</span> <span class="nx">buff</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">())</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">unfoldedPublicKeys</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">unfoldedPublicKeys</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span><span class="p">,</span> <span class="nx">unfoldedPublicKeys</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">getXYCoordinates</span><span class="p">(</span><span class="nx">key</span> <span class="o">*</span><span class="nx">ecdsa</span><span class="p">.</span><span class="nx">PublicKey</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
	<span class="nx">buff</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">{</span><span class="mh">0x04</span><span class="p">}</span> <span class="c1">// Uncompressed form.</span>
	<span class="nx">buff</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">buff</span><span class="p">,</span> <span class="nx">key</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">()</span><span class="o">...</span><span class="p">)</span>
	<span class="nx">buff</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">buff</span><span class="p">,</span> <span class="nx">key</span><span class="p">.</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">()</span><span class="o">...</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">buff</span>
<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-10">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
                <p>PublicKeyXYCoordinates outputs public key coordinates X, Y.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">func</span> <span class="nx">PublicKeyXYCoordinates</span><span class="p">(</span><span class="nx">pubicKey</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">matched</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">Match</span><span class="p">(</span><span class="s">`-+BEGIN PUBLIC KEY`</span><span class="p">,</span> <span class="nx">pubicKey</span><span class="p">);</span> <span class="nx">matched</span> <span class="p">{</span>
		<span class="nx">block</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">pem</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="nx">pubicKey</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">block</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">DecodePEMFailure</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">{}</span>
		<span class="p">}</span>
		<span class="nx">pubicKey</span> <span class="p">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">Bytes</span>
	<span class="p">}</span>
	<span class="nx">pub</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x509ec</span><span class="p">.</span><span class="nx">ParsePKIXPublicKey</span><span class="p">(</span><span class="nx">pubicKey</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">ParsePKIXPublicKeyFailed</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">{}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span><span class="p">,</span> <span class="nx">getXYCoordinates</span><span class="p">(</span><span class="nx">pub</span><span class="p">.(</span><span class="o">*</span><span class="nx">ecdsa</span><span class="p">.</span><span class="nx">PublicKey</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">decodePublicKeys</span><span class="p">(</span><span class="nx">pubKeysContent</span> <span class="p">[][]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">hasher</span> <span class="kd">func</span><span class="p">()</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="p">[]</span><span class="nx">HashIdentKey</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">identKeys</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">HashIdentKey</span><span class="p">{}</span>
	<span class="nx">fc</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">FactoryContext</span><span class="p">{</span><span class="nx">Hasher</span><span class="p">:</span> <span class="nx">hasher</span><span class="p">}</span>
	<span class="nx">digests</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="kd">var</span> <span class="nx">hash</span> <span class="kt">string</span>
	<span class="kd">var</span> <span class="nx">block</span> <span class="o">*</span><span class="nx">pem</span><span class="p">.</span><span class="nx">Block</span>

	<span class="nx">is_pem</span> <span class="o">:=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`-+BEGIN PUBLIC KEY`</span><span class="p">)</span>

	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">content</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">pubKeysContent</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">is_pem</span><span class="p">.</span><span class="nx">Match</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">block</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">pem</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
			<span class="k">if</span> <span class="nx">block</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">DecodePEMFailure</span><span class="p">,</span> <span class="nx">identKeys</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">{}</span>
			<span class="p">}</span>
			<span class="nx">content</span> <span class="p">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">Bytes</span>
		<span class="p">}</span>
		<span class="nx">pub</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x509ec</span><span class="p">.</span><span class="nx">ParsePKIXPublicKey</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">ParsePKIXPublicKeyFailed</span><span class="p">,</span> <span class="nx">identKeys</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">{}</span>
		<span class="p">}</span>
		<span class="nx">hash</span> <span class="p">=</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">MakeDigest</span><span class="p">(</span><span class="nx">getXYCoordinates</span><span class="p">(</span><span class="nx">pub</span><span class="p">.(</span><span class="o">*</span><span class="nx">ecdsa</span><span class="p">.</span><span class="nx">PublicKey</span><span class="p">))))</span>
		<span class="nx">digests</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">digests</span><span class="p">,</span> <span class="nx">hash</span><span class="o">...</span><span class="p">)</span>
		<span class="nx">digests</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">digests</span><span class="p">,</span> <span class="nx">Enter</span><span class="o">...</span><span class="p">)</span>

		<span class="nx">hidk</span> <span class="o">:=</span> <span class="nx">HashIdentKey</span><span class="p">{</span><span class="nx">pub</span><span class="p">:</span> <span class="nx">IdentKey</span><span class="p">{</span>
			<span class="nx">digest</span><span class="p">:</span> <span class="nx">hash</span><span class="p">,</span>
			<span class="nx">key</span><span class="p">:</span>    <span class="nx">pub</span><span class="p">.(</span><span class="o">*</span><span class="nx">ecdsa</span><span class="p">.</span><span class="nx">PublicKey</span><span class="p">),</span>
		<span class="p">}}</span>
		<span class="nx">identKeys</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">identKeys</span><span class="p">,</span> <span class="nx">hidk</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span><span class="p">,</span> <span class="nx">identKeys</span><span class="p">,</span> <span class="nx">fc</span><span class="p">.</span><span class="nx">MakeDigest</span><span class="p">(</span><span class="nx">digests</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">sortKeysByHashes</span><span class="p">(</span><span class="nx">publicKeys</span> <span class="p">[]</span><span class="nx">HashIdentKey</span><span class="p">,</span> <span class="nx">hashFnc</span> <span class="kd">func</span><span class="p">()</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="p">[]</span><span class="nx">HashIdentKey</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>

	<span class="nx">sortedPublicKeys</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">HashIdentKey</span><span class="p">{}</span>

	<span class="nx">fc</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">FactoryContext</span><span class="p">{</span><span class="nx">Hasher</span><span class="p">:</span> <span class="nx">hashFnc</span><span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-11">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
                <p>Sort keys by their hashes</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="nx">sort</span><span class="p">.</span><span class="nx">Slice</span><span class="p">(</span><span class="nx">publicKeys</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">publicKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pub</span><span class="p">.</span><span class="nx">digest</span> <span class="p">&lt;</span> <span class="nx">publicKeys</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">pub</span><span class="p">.</span><span class="nx">digest</span> <span class="p">})</span>
	<span class="nx">digestSum</span> <span class="o">:=</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">MakeDigest</span><span class="p">(</span><span class="nx">buildDigest</span><span class="p">(</span><span class="nx">publicKeys</span><span class="p">)))</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-12">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
                <p>Make digests with digestSum as a salt:</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">item</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">publicKeys</span> <span class="p">{</span>
		<span class="nx">item</span> <span class="o">:=</span> <span class="nx">HashIdentKey</span><span class="p">{</span>
			<span class="nx">hash</span><span class="p">:</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">MakeDigest</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">digestSum</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">digest</span><span class="p">))),</span>
			<span class="nx">pub</span><span class="p">:</span>  <span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">,</span>
		<span class="p">}</span>
		<span class="nx">sortedPublicKeys</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">sortedPublicKeys</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span>
	<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-13">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
                <p>Sort by hashes with fingerprint as a salt</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="nx">sort</span><span class="p">.</span><span class="nx">Slice</span><span class="p">(</span><span class="nx">sortedPublicKeys</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">sortedPublicKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">hash</span> <span class="p">&lt;</span> <span class="nx">sortedPublicKeys</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">hash</span> <span class="p">})</span>
	<span class="nx">digests</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">pk</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">sortedPublicKeys</span> <span class="p">{</span>
		<span class="nx">digests</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">digests</span><span class="p">,</span> <span class="nx">pk</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">digest</span><span class="o">...</span><span class="p">)</span>
		<span class="nx">digests</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">digests</span><span class="p">,</span> <span class="nx">Enter</span><span class="o">...</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span><span class="p">,</span> <span class="nx">sortedPublicKeys</span><span class="p">,</span> <span class="nx">fc</span><span class="p">.</span><span class="nx">MakeDigest</span><span class="p">(</span><span class="nx">digests</span><span class="p">)</span>
<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-14">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
                <p>PublicKeysDigest outputs public keys digest.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">func</span> <span class="nx">PublicKeysDigest</span><span class="p">(</span><span class="nx">foldedPublicKeys</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">separator</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">digest</span> <span class="p">[]</span><span class="kt">byte</span>

	<span class="nx">status</span><span class="p">,</span> <span class="nx">publicKeys</span><span class="p">,</span> <span class="nx">foldedKeys</span> <span class="o">:=</span> <span class="nx">UnfoldPublicKeysContent</span><span class="p">(</span><span class="nx">foldedPublicKeys</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">status</span> <span class="o">!=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">digest</span>
	<span class="p">}</span>
	<span class="nx">hashFnc</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">GetHasher</span><span class="p">(</span><span class="nx">foldedKeys</span><span class="p">.</span><span class="nx">HasherOID</span><span class="p">)</span>
	<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">UnexpectedHashType</span><span class="p">,</span> <span class="nx">digest</span>
	<span class="p">}</span>
	<span class="nx">fc</span> <span class="o">:=</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">FactoryContext</span><span class="p">{</span><span class="nx">Hasher</span><span class="p">:</span> <span class="nx">hashFnc</span><span class="p">}</span>
	<span class="nx">digests</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">pub</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">publicKeys</span> <span class="p">{</span>
		<span class="nx">hash</span> <span class="o">:=</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">MakeDigest</span><span class="p">(</span><span class="nx">getXYCoordinates</span><span class="p">(</span><span class="nx">pub</span><span class="p">)))</span>
		<span class="nx">digests</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">digests</span><span class="p">,</span> <span class="nx">hash</span><span class="o">...</span><span class="p">)</span>
		<span class="nx">digests</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">digests</span><span class="p">,</span> <span class="nx">Enter</span><span class="o">...</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">content</span> <span class="o">:=</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">MakeDigest</span><span class="p">(</span><span class="nx">digests</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">separator</span> <span class="p">{</span>
		<span class="nx">content</span> <span class="p">=</span> <span class="nx">FormatDigest</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ring</span><span class="p">.</span><span class="nx">Success</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">buildDigest</span><span class="p">(</span><span class="nx">hk</span> <span class="p">[]</span><span class="nx">HashIdentKey</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
	<span class="nx">digests</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">item</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">hk</span> <span class="p">{</span>
		<span class="nx">digests</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">digests</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pub</span><span class="p">.</span><span class="nx">digest</span><span class="o">...</span><span class="p">)</span>
		<span class="nx">digests</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">digests</span><span class="p">,</span> <span class="nx">Enter</span><span class="o">...</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">digests</span>
<span class="p">}</span>

</pre></div>
            </td>
          </tr>
          
      </tbody>
    </table>
  </div>
<footer>
    <a href="https://github.com/zbohm/lirisi/">Lirisi</a>; Zdeněk Böhm.
    <a href="https://en.wikipedia.org/wiki/Literate_programming">Literate programming</a>.
</footer>
</body>
</html>
